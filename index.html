<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Central de Estudos - HackPad</title>
    <!-- Carregando Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carregando a fonte Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- SDKs do Firebase (M√≥dulos Atualizados para Login) -->
    <script type="module">
        // --- Configura√ß√£o do Firebase ---
        // (Movida para c√° para funcionar no GitHub/ambientes externos)
        const firebaseConfig = {
          apiKey: "AIzaSyD1j7ynpoB_Qalk8h9xZPmCSnAGCwKhHGk",
          authDomain: "strange-descent-449722-b5.firebaseapp.com",
          projectId: "strange-descent-449722-b5",
          storageBucket: "strange-descent-449722-b5.firebasestorage.app",
          messagingSenderId: "563644382085",
          appId: "1:563644382085:web:9a8b42cceec735247ce2ec"
        };
        
        // --- Lembrete sobre o Erro "auth/unauthorized-domain" ---
        console.warn(
            'Lembrete: O erro "auth/unauthorized-domain" deve ser corrigido no Console do Firebase. ' +
            'Adicione este dom√≠nio √† lista de "Dom√≠nios autorizados" na aba "Authentication" -> "Sign-in method".'
        );

        // Importa√ß√µes do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged, 
            GoogleAuthProvider, 
            signInWithPopup,    
            signOut             
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, doc, getDoc, setDoc, onSnapshot, 
            collection, query, addDoc, getDocs, deleteDoc, updateDoc 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Inicializa o Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        // As vari√°veis s√£o declaradas aqui, mas os elementos (getElementById)
        // s√≥ s√£o buscados DEPOIS que o DOM estiver carregado.
        let mainAppDiv, loginDiv, loginBtn, logoutBtn, userEmailDisplay;

        // --- NOVO: Fun√ß√£o de API Gemini com Backoff Exponencial ---
        /**
         * Faz uma chamada fetch para a API Gemini com retentativa e backoff.
         * @param {string} apiUrl O endpoint da API.
         * @param {object} payload O corpo da requisi√ß√£o.
         * @param {number} maxRetries M√°ximo de tentativas.
         * @returns {Promise<object>} A resposta da API em JSON.
         */
        async function fetchWithBackoff(apiUrl, payload, maxRetries = 5) {
            let attempt = 0;
            let delay = 1000; // 1 segundo inicial

            while (attempt < maxRetries) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        return await response.json();
                    } else if (response.status === 429 || response.status >= 500) {
                        // 429 (Too Many Requests) ou erro de servidor
                        console.warn(`Tentativa ${attempt + 1} falhou com status ${response.status}. Tentando novamente em ${delay}ms...`);
                    } else {
                        // Outro erro (ex: 400 Bad Request), n√£o tentar novamente
                        console.error(`Erro ${response.status}: ${response.statusText}`);
                        throw new Error(`Erro de API: ${response.statusText}`);
                    }
                } catch (error) {
                    // Erro de rede
                    console.warn(`Tentativa ${attempt + 1} falhou com erro de rede. Tentando novamente em ${delay}ms...`);
                }

                await new Promise(resolve => setTimeout(resolve, delay));
                delay *= 2; // Dobra o tempo de espera
                attempt++;
            }
            throw new Error('Falha ao chamar a API Gemini ap√≥s m√∫ltiplas tentativas.');
        }


        // Fun√ß√£o principal de inicializa√ß√£o
        function initApp() {
            // Adiciona listeners aos bot√µes de login/logout
            loginBtn.addEventListener('click', loginWithGoogle);
            logoutBtn.addEventListener('click', logout);

            // Ouve o estado da autentica√ß√£o
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    // --- USU√ÅRIO EST√Å LOGADO ---
                    mainAppDiv.style.display = 'flex'; // Mostra o app
                    loginDiv.style.display = 'none'; // Esconde o login
                    userEmailDisplay.textContent = user.email; // Mostra o email
                    
                    const appId = 'studyhub-hackpad'; 
                    
                    // Inicializa os componentes que dependem do Firebase
                    // (Agora esta fun√ß√£o inicializa TUDO)
                    initComponents(db, auth, appId, user.uid);
                } else {
                    // --- USU√ÅRIO EST√Å DESLOGADO ---
                    mainAppDiv.style.display = 'none'; // Esconde o app
                    loginDiv.style.display = 'flex'; // Mostra o login
                    userEmailDisplay.textContent = '';
                }
            });
        }
        
        // Fun√ß√£o para fazer login com Google
        async function loginWithGoogle() {
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                console.error("Erro ao fazer login com Google:", error);
            }
        }

        // Fun√ß√£o para fazer logout
        async function logout() {
            try {
                await signOut(auth);
            } catch (error) {
                console.error("Erro ao fazer logout:", error);
            }
        }
        
        // O script espera o DOM carregar ANTES de tentar encontrar
        // os elementos e inicializar o app.
        document.addEventListener('DOMContentLoaded', () => {
            // Agora √© seguro buscar os elementos
            mainAppDiv = document.getElementById('main-app');
            loginDiv = document.getElementById('app-login');
            loginBtn = document.getElementById('loginWithGoogleBtn');
            logoutBtn = document.getElementById('logoutBtn');
            userEmailDisplay = document.getElementById('userEmail');
            
            // Inicia a aplica√ß√£o
            initApp();
        });

        
        // Esta fun√ß√£o wrapper ser√° chamada AP√ìS o login
        // --- CORRE√á√ÉO: Agora ela inicializa TODAS as ferramentas ---
        function initComponents(db, auth, appId, userId) {
            
            // --- L√≥gica de Navega√ß√£o (SPA) ---
            const navLinks = document.querySelectorAll('.nav-link');
            const appViews = document.querySelectorAll('.app-view');

            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    const targetId = link.dataset.target;
                    appViews.forEach(view => view.classList.add('hidden'));
                    document.getElementById(targetId).classList.remove('hidden');
                    navLinks.forEach(nav => nav.classList.remove('active'));
                    link.classList.add('active');
                });
            });

            // --- Gerenciador de Feedback Global ---
            const feedbackModal = document.getElementById('feedbackModal');
            const feedbackMessage = document.getElementById('feedbackMessage');
            let feedbackTimeout;
            
            function showFeedback(message, duration = 1500) {
                clearTimeout(feedbackTimeout);
                feedbackMessage.textContent = message;
                feedbackModal.classList.remove('hidden');
                feedbackTimeout = setTimeout(() => {
                    feedbackModal.classList.add('hidden');
                }, duration);
            }
            // Disponibiliza globalmente para o Pomodoro
            window.showGlobalFeedback = showFeedback;
            
            // --- Gerenciador de Confirma√ß√£o Global ---
            const confirmModal = document.getElementById('confirmModal');
            const confirmMessage = document.getElementById('confirmMessage');
            const confirmBtnYes = document.getElementById('confirmBtnYes');
            const confirmBtnNo = document.getElementById('confirmBtnNo');

            function showConfirm(message, onConfirm) {
                confirmMessage.textContent = message;
                confirmModal.classList.remove('hidden');
                
                const newConfirmBtnYes = confirmBtnYes.cloneNode(true);
                confirmBtnYes.parentNode.replaceChild(newConfirmBtnYes, confirmBtnYes);
                
                const newConfirmBtnNo = confirmBtnNo.cloneNode(true);
                confirmBtnNo.parentNode.replaceChild(newConfirmBtnNo, confirmBtnNo);
                
                newConfirmBtnYes.addEventListener('click', () => {
                    onConfirm();
                    confirmModal.classList.add('hidden');
                });
                newConfirmBtnNo.addEventListener('click', () => {
                    confirmModal.classList.add('hidden');
                });
            }

            // --- Verifica√ß√£o de Inicializa√ß√£o ---
            if (!db || !userId) {
                console.error("Firebase n√£o inicializado corretamente. Os aplicativos conectados √† nuvem n√£o funcionar√£o.");
                return;
            }
            
            // --- Refer√™ncias do Firestore ---
            const todoCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/tarefas`);
            const flashcardsCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/flashcards`);
            const notepadDocRef = doc(db, `artifacts/${appId}/users/${userId}/blocoDeNotas/unicaNota`);
            const linksCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/links`);
            const metasDocRef = doc(db, `artifacts/${appId}/users/${userId}/metas/diarias`); 
            const habitosCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/habitos`); // NOVO

            // --- M√≥dulo: Lista de Tarefas (Firestore) ---
            function initTodoApp() {
                const todoInput = document.getElementById('todoInput');
                const addTodoBtn = document.getElementById('addTodoBtn');
                const todoList = document.getElementById('todoList');

                function renderTasks(tasks) {
                    todoList.innerHTML = ''; 
                    if (tasks.length === 0) {
                        todoList.innerHTML = '<p class="text-gray-500 text-center">Nenhuma tarefa ainda.</p>';
                        return;
                    }
                    tasks.forEach((task) => {
                        const li = document.createElement('li');
                        li.className = `task-item flex items-center justify-between bg-gray-50 p-3 rounded-lg border ${task.completed ? 'completed' : ''}`;
                        li.innerHTML = `
                            <span class="flex-grow cursor-pointer">${task.text}</span>
                            <button data-id="${task.id}" class="delete-task-btn text-red-500 hover:text-red-700 p-1 rounded-full">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                            </button>
                        `;
                        li.querySelector('span').addEventListener('click', async () => {
                            const taskDocRef = doc(db, `artifacts/${appId}/users/${userId}/tarefas`, task.id);
                            await updateDoc(taskDocRef, { completed: !task.completed });
                        });
                        li.querySelector('.delete-task-btn').addEventListener('click', async () => {
                            const taskDocRef = doc(db, `artifacts/${appId}/users/${userId}/tarefas`, task.id);
                            await deleteDoc(taskDocRef);
                        });
                        todoList.appendChild(li);
                    });
                }

                addTodoBtn.addEventListener('click', async () => {
                    const text = todoInput.value.trim();
                    if (text) {
                        try {
                            await addDoc(todoCollectionRef, { text: text, completed: false });
                            todoInput.value = '';
                        } catch (e) { console.error("Erro ao adicionar tarefa: ", e); showFeedback("Erro ao salvar tarefa."); }
                    }
                });
                todoInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') { addTodoBtn.click(); } });
                
                // Listener do Firestore para carregar dados
                onSnapshot(todoCollectionRef, (snapshot) => {
                    const tasks = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    renderTasks(tasks);
                });
            }
            
            // --- NOVO M√≥dulo: Rastreador de H√°bitos (Firestore) ---
            function initHabitosApp() {
                const habitInput = document.getElementById('habitInput');
                const addHabitBtn = document.getElementById('addHabitBtn');
                const habitosList = document.getElementById('habitosList');

                function renderHabitos(habitos) {
                    habitosList.innerHTML = ''; 
                    if (habitos.length === 0) {
                        habitosList.innerHTML = '<p class="text-gray-500 text-center">Nenhum h√°bito adicionado.</p>';
                        return;
                    }
                    habitos.forEach((habit) => {
                        const li = document.createElement('li');
                        li.className = `task-item flex items-center justify-between bg-gray-50 p-3 rounded-lg border ${habit.completed ? 'completed' : ''}`;
                        li.innerHTML = `
                            <span class="flex-grow cursor-pointer">${habit.text}</span>
                            <button data-id="${habit.id}" class="delete-habit-btn text-red-500 hover:text-red-700 p-1 rounded-full">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                            </button>
                        `;
                        li.querySelector('span').addEventListener('click', async () => {
                            const habitDocRef = doc(db, `artifacts/${appId}/users/${userId}/habitos`, habit.id);
                            await updateDoc(habitDocRef, { completed: !habit.completed });
                        });
                        li.querySelector('.delete-habit-btn').addEventListener('click', async () => {
                            const habitDocRef = doc(db, `artifacts/${appId}/users/${userId}/habitos`, habit.id);
                            await deleteDoc(habitDocRef);
                        });
                        habitosList.appendChild(li);
                    });
                }

                addHabitBtn.addEventListener('click', async () => {
                    const text = habitInput.value.trim();
                    if (text) {
                        try {
                            await addDoc(habitosCollectionRef, { text: text, completed: false });
                            habitInput.value = '';
                        } catch (e) { console.error("Erro ao adicionar h√°bito: ", e); showFeedback("Erro ao salvar h√°bito."); }
                    }
                });
                habitInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') { addHabitBtn.click(); } });
                
                onSnapshot(habitosCollectionRef, (snapshot) => {
                    const habitos = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    renderHabitos(habitos);
                });
            }

            // --- M√≥dulo: Flashcards (Firestore) ---
            function initFlashcardApp() {
                const frenteInput = document.getElementById('frente');
                const versoInput = document.getElementById('verso');
                const addCardBtn = document.getElementById('addCardBtn');
                const clearCardsBtn = document.getElementById('clearCardsBtn');
                const cardContainer = document.getElementById('cardContainer');
                const cardFrente = document.getElementById('cardFrente');
                const cardVerso = document.getElementById('cardVerso');
                const cardCounter = document.getElementById('cardCounter');
                const prevBtn = document.getElementById('prevBtn');
                const flipBtn = document.getElementById('flipBtn');
                const nextBtn = document.getElementById('nextBtn');
                const shuffleBtn = document.getElementById('shuffleBtn');
                
                // --- NOVO: Elementos da IA ---
                const aiThemeInput = document.getElementById('aiThemeInput');
                const aiGenerateBtn = document.getElementById('aiGenerateBtn');
                const aiLoading = document.getElementById('aiLoading');

                let cards = [];
                let currentCardIndex = 0;
                let isFlipped = false;
                
                function updateCardView() {
                    if (cards.length === 0) {
                        cardFrente.textContent = 'Crie um card para come√ßar!';
                        cardVerso.textContent = '';
                        cardCounter.textContent = 'Card 0 / 0';
                        disableControls(true);
                        return;
                    }
                    disableControls(false);
                    if (isFlipped) {
                        cardContainer.classList.remove('is-flipped');
                        isFlipped = false;
                    }
                    const card = cards[currentCardIndex];
                    if (card) {
                        cardFrente.textContent = card.frente;
                        cardVerso.textContent = card.verso;
                        cardCounter.textContent = `Card ${currentCardIndex + 1} / ${cards.length}`;
                        prevBtn.disabled = currentCardIndex === 0;
                        nextBtn.disabled = currentCardIndex === cards.length - 1;
                    } else if (cards.length > 0) {
                        currentCardIndex = 0;
                        updateCardView();
                    }
                }

                function disableControls(disabled) {
                    prevBtn.disabled = disabled; nextBtn.disabled = disabled;
                    flipBtn.disabled = disabled; shuffleBtn.disabled = disabled;
                }

                async function addCard() {
                    const frente = frenteInput.value.trim(); const verso = versoInput.value.trim();
                    if (!frente || !verso) { showFeedback('Preencha a frente e o verso.'); return; }
                    try {
                        await addDoc(flashcardsCollectionRef, { frente, verso });
                        frenteInput.value = ''; versoInput.value = ''; frenteInput.focus();
                        showFeedback('Card adicionado!');
                    } catch (e) { console.error("Erro ao adicionar card: ", e); showFeedback("Erro ao salvar card."); }
                }

                function clearCards() {
                    showConfirm('Tem certeza que deseja apagar TODOS os cards?', async () => {
                        try {
                            const querySnapshot = await getDocs(flashcardsCollectionRef);
                            const deletePromises = [];
                            querySnapshot.forEach((docSnap) => { deletePromises.push(deleteDoc(docSnap.ref)); });
                            await Promise.all(deletePromises);
                            showFeedback('Todos os cards foram apagados.');
                        } catch (e) { console.error("Erro ao limpar cards: ", e); showFeedback("Erro ao apagar cards."); }
                    });
                }
                function flipCard() { if (cards.length === 0) return; isFlipped = !isFlipped; cardContainer.classList.toggle('is-flipped'); }
                function nextCard() { if (currentCardIndex < cards.length - 1) { currentCardIndex++; updateCardView(); } }
                function prevCard() { if (currentCardIndex > 0) { currentCardIndex--; updateCardView(); } }
                function shuffleCards() {
                    if (cards.length < 2) { showFeedback('Adicione pelo menos 2 cards para embaralhar.'); return; }
                    for (let i = cards.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [cards[i], cards[j]] = [cards[j], cards[i]]; }
                    currentCardIndex = 0; showFeedback('Cards embaralhados!'); updateCardView();
                }

                addCardBtn.addEventListener('click', addCard);
                clearCardsBtn.addEventListener('click', clearCards);
                flipBtn.addEventListener('click', flipCard);
                nextBtn.addEventListener('click', nextCard);
                prevBtn.addEventListener('click', prevCard);
                shuffleBtn.addEventListener('click', shuffleCards);

                onSnapshot(flashcardsCollectionRef, (snapshot) => {
                    cards = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    if (currentCardIndex >= cards.length) { currentCardIndex = 0; }
                    updateCardView();
                });
                
                // --- NOVO: L√≥gica do Gerador de IA ---
                aiGenerateBtn.addEventListener('click', async () => {
                    const theme = aiThemeInput.value.trim();
                    if (!theme) {
                        showFeedback("Por favor, insira um tema.");
                        return;
                    }

                    // Mostra o loading e desabilita o bot√£o
                    aiLoading.classList.remove('hidden');
                    aiGenerateBtn.disabled = true;
                    aiGenerateBtn.textContent = 'Gerando...';

                    const apiKey = "AIzaSyCb56B8KX-aUMDchEw2UfVr4Ze7lBI6kn8"; // API Key do usu√°rio
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

                    const systemPrompt = `Voc√™ √© um assistente de estudos. Sua tarefa √© gerar 5 flashcards (pergunta e resposta) sobre um tema.
                    Responda APENAS com um array de objetos JSON. Cada objeto deve ter duas chaves: "frente" (para a pergunta) e "verso" (para a resposta).
                    N√£o inclua \`\`\`json ou qualquer outro texto fora do array.`;
                    
                    const userQuery = `Tema: ${theme}`;

                    const payload = {
                        contents: [{ parts: [{ text: userQuery }] }],
                        systemInstruction: {
                            parts: [{ text: systemPrompt }]
                        },
                        generationConfig: {
                            responseMimeType: "application/json",
                            responseSchema: {
                                type: "ARRAY",
                                items: {
                                    type: "OBJECT",
                                    properties: {
                                        "frente": { "type": "STRING" },
                                        "verso": { "type": "STRING" }
                                    },
                                    required: ["frente", "verso"]
                                }
                            }
                        }
                    };

                    try {
                        const result = await fetchWithBackoff(apiUrl, payload);
                        
                        if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts[0].text) {
                            const jsonText = result.candidates[0].content.parts[0].text;
                            const generatedCards = JSON.parse(jsonText);

                            // Salva os cards no Firebase
                            const savePromises = generatedCards.map(card => {
                                return addDoc(flashcardsCollectionRef, { 
                                    frente: card.frente, 
                                    verso: card.verso 
                                });
                            });
                            
                            await Promise.all(savePromises);
                            
                            showFeedback(`${generatedCards.length} cards gerados e salvos!`);
                            aiThemeInput.value = ''; // Limpa o input
                        } else {
                            throw new Error("Resposta da IA em formato inesperado.");
                        }

                    } catch (error) {
                        console.error("Erro ao gerar cards com IA:", error);
                        showFeedback("Erro ao gerar cards. Tente novamente.");
                    } finally {
                        // Esconde o loading e reabilita o bot√£o
                        aiLoading.classList.add('hidden');
                        aiGenerateBtn.disabled = false;
                        aiGenerateBtn.textContent = 'Gerar';
                    }
                });
            }

            // --- M√≥dulo: Bloco de Notas (Firestore) ---
            function initNotepadApp() {
                const notepadText = document.getElementById('notepadText');
                const saveNoteBtn = document.getElementById('saveNoteBtn');

                function loadNote() {
                    onSnapshot(notepadDocRef, (docSnap) => {
                        if (docSnap.exists()) { notepadText.value = docSnap.data().content || ''; } 
                        else { notepadText.value = ''; }
                    }, (error) => { console.error("Erro ao carregar nota: ", error); notepadText.value = "Erro ao carregar nota."; });
                }
                async function saveNote() {
                    try {
                        await setDoc(notepadDocRef, { content: notepadText.value });
                        showFeedback('Anota√ß√£o salva!');
                    } catch (e) { console.error("Erro ao salvar nota: ", e); showFeedback('Erro ao salvar.'); }
                }
                saveNoteBtn.addEventListener('click', saveNote);
                loadNote();
            }

            // --- M√≥dulo: Links R√°pidos (Firestore) ---
            function initLinksApp() {
                const linkNameInput = document.getElementById('linkNameInput');
                const linkUrlInput = document.getElementById('linkUrlInput');
                const addLinkBtn = document.getElementById('addLinkBtn');
                const linksList = document.getElementById('linksList');

                function renderLinks(links) {
                    linksList.innerHTML = '';
                    if (links.length === 0) { linksList.innerHTML = '<p class="text-gray-500 text-center">Nenhum link salvo.</p>'; return; }
                    links.forEach(link => {
                        const li = document.createElement('li');
                        li.className = 'flex items-center justify-between bg-gray-50 p-3 rounded-lg border';
                        li.innerHTML = `
                            <a href="${link.url}" target="_blank" rel="noopener noreferrer" class="font-medium text-indigo-600 hover:text-indigo-800 break-all">
                                ${link.nome}
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 inline-block ml-1"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" /></svg>
                            </a>
                            <button data-id="${link.id}" class="delete-link-btn text-red-500 hover:text-red-700 p-1 rounded-full flex-shrink-0 ml-2">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                            </button>
                        `;
                        li.querySelector('.delete-link-btn').addEventListener('click', async () => {
                            const linkDocRef = doc(db, `artifacts/${appId}/users/${userId}/links`, link.id);
                            await deleteDoc(linkDocRef);
                        });
                        linksList.appendChild(li);
                    });
                }
                addLinkBtn.addEventListener('click', async () => {
                    const nome = linkNameInput.value.trim(); let url = linkUrlInput.value.trim();
                    if (!nome || !url) { showFeedback('Preencha o nome e a URL.'); return; }
                    if (!url.startsWith('http://') && !url.startsWith('https://')) { url = 'https://' + url; }
                    try {
                        await addDoc(linksCollectionRef, { nome, url });
                        linkNameInput.value = ''; linkUrlInput.value = '';
                    } catch (e) { console.error("Erro ao adicionar link: ", e); showFeedback("Erro ao salvar link."); }
                });
                onSnapshot(linksCollectionRef, (snapshot) => {
                    const links = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    renderLinks(links);
                });
            }

            // --- M√≥dulo: Metas Di√°rias (Firestore) ---
            function initMetasApp() {
                const metasText = document.getElementById('metasText');
                const saveMetasBtn = document.getElementById('saveMetasBtn');
                
                // Carrega as metas salvas
                onSnapshot(metasDocRef, (docSnap) => {
                    if (docSnap.exists()) { metasText.value = docSnap.data().content || ''; } 
                    else { metasText.value = '1. \n2. \n3. '; }
                }, (error) => { console.error("Erro ao carregar metas: ", error); metasText.value = "Erro ao carregar metas."; });

                // Salva as metas
                saveMetasBtn.addEventListener('click', async () => {
                    try {
                        await setDoc(metasDocRef, { content: metasText.value });
                        showFeedback('Metas salvas!');
                    } catch (e) { console.error("Erro ao salvar metas: ", e); showFeedback('Erro ao salvar.'); }
                });
            }

            // --- M√≥dulo: Timer Pomodoro (LOCAL - MOVIDO PARA C√Å) ---
            function initPomodoroApp() {
                const timerDisplay = document.getElementById('timerDisplay');
                const startBtn = document.getElementById('startPomodoroBtn');
                const resetBtn = document.getElementById('resetPomodoroBtn');
                const statusDisplay = document.getElementById('pomodoroStatus');
                
                const DURATION = 25 * 60;
                let secondsRemaining = DURATION;
                let timerInterval = null;
                let isPaused = true;

                function formatTime(seconds) {
                    const min = Math.floor(seconds / 60); const sec = seconds % 60;
                    return `${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
                }
                function updateDisplay() { timerDisplay.textContent = formatTime(secondsRemaining); }
                function startTimer() {
                    isPaused = false; startBtn.textContent = 'Pausar'; statusDisplay.textContent = 'Hora de focar!';
                    timerInterval = setInterval(() => {
                        secondsRemaining--; updateDisplay();
                        if (secondsRemaining <= 0) {
                            clearInterval(timerInterval);
                            statusDisplay.textContent = 'Pausa! (5 min)';
                            if (window.showGlobalFeedback) { window.showGlobalFeedback('Pomodoro conclu√≠do! Hora de uma pausa.', 5000); }
                            resetTimer(false);
                        }
                    }, 1000);
                }
                function pauseTimer() {
                    isPaused = true; clearInterval(timerInterval);
                    startBtn.textContent = 'Continuar'; statusDisplay.textContent = 'Pausado';
                }
                function resetTimer(showAlert = true) {
                    clearInterval(timerInterval); isPaused = true; secondsRemaining = DURATION;
                    updateDisplay(); startBtn.textContent = 'Iniciar'; statusDisplay.textContent = '\u00A0';
                    if(showAlert && window.showGlobalFeedback) { window.showGlobalFeedback('Timer resetado.'); }
                }
                startBtn.addEventListener('click', () => { if (isPaused) { startTimer(); } else { pauseTimer(); } });
                resetBtn.addEventListener('click', () => resetTimer(true)); // Passa true explicitamente
                updateDisplay();
            }

            // --- M√≥dulo: Calculadora de M√©dia (LOCAL - MOVIDO PARA C√Å) ---
            function initCalculadoraApp() {
                const addNotaBtn = document.getElementById('addNotaBtn');
                const notasContainer = document.getElementById('notasContainer');
                const calcularMediaBtn = document.getElementById('calcularMediaBtn');
                const mediaResultado = document.getElementById('mediaResultado');
                
                let notaCount = 2; // Come√ßa com 2 campos

                addNotaBtn.addEventListener('click', () => {
                    notaCount++;
                    const div = document.createElement('div');
                    div.className = "flex items-center gap-2";
                    div.innerHTML = `
                        <label for="nota-${notaCount}" class="text-sm font-medium text-gray-700 w-12">Nota ${notaCount}:</label>
                        <input type="number" id="nota-${notaCount}" class="nota-input w-full p-2 border border-gray-300 rounded-lg" placeholder="0.0">
                    `;
                    notasContainer.appendChild(div);
                });

                calcularMediaBtn.addEventListener('click', () => {
                    const inputs = document.querySelectorAll('.nota-input');
                    let total = 0;
                    let count = 0;
                    inputs.forEach(input => {
                        const value = parseFloat(input.value);
                        if (!isNaN(value)) {
                            total += value;
                            count++;
                        }
                    });

                    if (count > 0) {
                        const media = total / count;
                        mediaResultado.textContent = `Sua m√©dia √©: ${media.toFixed(2)}`;
                        mediaResultado.classList.remove('text-red-600');
                        mediaResultado.classList.add('text-green-600');
                    } else {
                        mediaResultado.textContent = 'Por favor, insira pelo menos uma nota v√°lida.';
                        mediaResultado.classList.add('text-red-600');
                        mediaResultado.classList.remove('text-green-600');
                    }
                });
            }
            
            // --- NOVO M√≥dulo: M√∫sica Foco (LOCAL) ---
            function initMusicaApp() {
                // Ferramenta local simples
                // A l√≥gica est√° nos links <a> do HTML
                // Pode adicionar listeners de "play" no futuro
                console.log("M√≥dulo de M√∫sica para Foco inicializado.");
            }


            // --- INICIALIZA√á√ÉO DE TODOS OS M√ìCULOS ---
            initTodoApp();
            initHabitosApp(); // NOVO
            initFlashcardApp();
            initNotepadApp();
            initLinksApp();
            initMetasApp(); 
            initPomodoroApp(); 
            initCalculadoraApp(); 
            initMusicaApp(); // NOVO
        }
    </script>
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .card-scene { perspective: 1000px; }
        .card-container { width: 100%; height: 100%; position: relative; transition: transform 0.6s; transform-style: preserve-3d; }
        .card-container.is-flipped { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; display: flex; align-items-center; justify-content: center; padding: 1.5rem; border-radius: 0.75rem; box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); }
        .card-face-front { background-color: white; color: #1f2937; }
        .card-face-back { background-color: #4f46e5; color: white; transform: rotateY(180deg); }
        .nav-link.active { background-color: #4f46e5; color: white; }
        .task-item.completed span { text-decoration: line-through; color: #6b7280; }
        #main-app { display: none; } /* Oculto por padr√£o, JS mostra ap√≥s login */
        
        /* NOVO: Estilo para o loader da IA */
        #aiLoading {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="h-screen overflow-hidden">

    <!-- #################### TELA DE LOGIN #################### -->
    <div id="app-login" class="flex h-screen w-screen items-center justify-center bg-gray-100">
        <div class="bg-white p-10 rounded-xl shadow-2xl text-center max-w-md">
            <h1 class="text-4xl font-bold text-indigo-600 mb-4">StudyHub üöÄ</h1>
            <p class="text-lg text-gray-600 mb-8">Sua central de ferramentas para o HackPad 2025.</p>
            <button id="loginWithGoogleBtn" class="w-full flex items-center justify-center gap-3 bg-white border border-gray-300 text-gray-700 py-3 px-6 rounded-lg font-semibold hover:bg-gray-50 transition shadow-md">
                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611 20.083H42V20H24v8h11.303c-1.649 4.657-6.08 8-11.303 8c-6.627 0-12-5.373-12-12s5.373-12 12-12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4C12.955 4 4 12.955 4 24s8.955 20 20 20s20-8.955 20-20c0-1.341-.138-2.65-.389-3.917z"/><path fill="#FF3D00" d="M6.306 14.691l6.571 4.819C14.655 15.108 18.961 12 24 12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4C16.318 4 9.656 8.337 6.306 14.691z"/><path fill="#4CAF50" d="M24 44c5.166 0 9.86-1.977 13.409-5.192l-6.19-5.238C29.211 35.091 26.715 36 24 36c-5.202 0-9.619-3.317-11.283-7.946l-6.522 5.025C9.505 39.556 16.227 44 24 44z"/><path fill="#1976D2" d="M43.611 20.083H42V20H24v8h11.303c-.792 2.237-2.231 4.166-4.087 5.571l.001-.001l6.19 5.238C36.971 39.205 44 34 44 24c0-1.341-.138-2.65-.389-3.917z"/></svg>
                Entrar com Google
            </button>
        </div>
    </div>


    <!-- #################### APLICA√á√ÉO PRINCIPAL (Oculta) #################### -->
    <div id="main-app" class="flex h-screen overflow-hidden">
        <!-- Barra Lateral de Navega√ß√£o -->
        <nav class="w-64 bg-white shadow-lg p-6 flex flex-col flex-shrink-0 overflow-y-auto">
            <h1 class="text-3xl font-bold text-indigo-600 mb-8">StudyHub üöÄ</h1>
            <ul class="space-y-3">
                <li>
                    <button data-target="app-painel" class="nav-link active w-full text-left flex items-center gap-3 px-4 py-3 rounded-lg font-medium text-gray-700 hover:bg-gray-200 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h12A2.25 2.25 0 0120.25 6v12A2.25 2.25 0 0118 20.25H6A2.25 2.25 0 013.75 18V6zM3.75 12h16.5M12 3.75v16.5" /></svg>
                        Painel
                    </button>
                </li>
                <li>
                    <button data-target="app-tarefas" class="nav-link w-full text-left flex items-center gap-3 px-4 py-3 rounded-lg font-medium text-gray-700 hover:bg-gray-200 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zM3.75 12h.007v.008H3.75V12zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm-.375 5.25h.007v.008H3.75v-.008zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" /></svg>
                        Tarefas
                    </button>
                </li>
                <li>
                    <button data-target="app-metas" class="nav-link w-full text-left flex items-center gap-3 px-4 py-3 rounded-lg font-medium text-gray-700 hover:bg-gray-200 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 18.75h-9m9 0a3 3 0 013 3h-15a3 3 0 013-3m9 0v-3.375c0-.621-.503-1.125-1.125-1.125h-6.75c-.621 0-1.125.503-1.125 1.125V18.75m9 0h-9" /></svg>
                        Metas Di√°rias
                    </button>
                </li>
                <!-- NOVO: Bot√£o H√°bitos -->
                <li>
                    <button data-target="app-habitos" class="nav-link w-full text-left flex items-center gap-3 px-4 py-3 rounded-lg font-medium text-gray-700 hover:bg-gray-200 transition">
                         <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" /></svg>
                        H√°bitos
                    </button>
                </li>
                <li>
                    <button data-target="app-flashcards" class="nav-link w-full text-left flex items-center gap-3 px-4 py-3 rounded-lg font-medium text-gray-700 hover:bg-gray-200 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 8.25V6a2.25 2.25 0 00-2.25-2.25H6A2.25 2.25 0 003.75 6v8.25A2.25 2.25 0 006 16.5h2.25m8.25-8.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-7.5A2.25 2.25 0 018.25 18v-1.5m8.25-8.25h-6.75a.75.75 0 00-.75.75v6.75a.75.75 0 00.75.75h6.75a.75.75 0 00.75-.75v-6.75a.75.75 0 00-.75-.75z" /></svg>
                        Flashcards (IA) ‚ú®
                    </button>
                </li>
                <li>
                    <button data-target="app-pomodoro" class="nav-link w-full text-left flex items-center gap-3 px-4 py-3 rounded-lg font-medium text-gray-700 hover:bg-gray-200 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        Timer Pomodoro
                    </button>
                </li>
                <li>
                    <button data-target="app-notas" class="nav-link w-full text-left flex items-center gap-3 px-4 py-3 rounded-lg font-medium text-gray-700 hover:bg-gray-200 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" /></svg>
                        Bloco de Notas
                    </button>
                </li>
                <li>
                    <button data-target="app-links" class="nav-link w-full text-left flex items-center gap-3 px-4 py-3 rounded-lg font-medium text-gray-700 hover:bg-gray-200 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244" /></svg>
                        Links R√°pidos
                    </button>
                </li>
                <li>
                    <button data-target="app-calculadora" class="nav-link w-full text-left flex items-center gap-3 px-4 py-3 rounded-lg font-medium text-gray-700 hover:bg-gray-200 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 15.75l-2.489-2.489m0 0a3.375 3.375 0 10-4.773-4.773 3.375 3.375 0 004.774 4.774zM21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        Calculadora M√©dia
                    </button>
                </li>
                 <!-- NOVO: Bot√£o M√∫sica -->
                <li>
                    <button data-target="app-musica" class="nav-link w-full text-left flex items-center gap-3 px-4 py-3 rounded-lg font-medium text-gray-700 hover:bg-gray-200 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M9 9l10.5-3m0 6.553v3.75a2.25 2.25 0 01-1.07 1.916l-7.5 4.25a2.25 2.25 0 01-2.36 0L3.32 15.22a2.25 2.25 0 01-1.07-1.916V9.61a2.25 2.25 0 011.07-1.916l7.5-4.25a2.25 2.25 0 012.36 0l7.5 4.25A2.25 2.25 0 0119.5 9.61v0z" /></svg>
                        M√∫sica Foco
                    </button>
                </li>
            </ul>
            <!-- Bot√£o de Logout -->
            <div class="mt-auto">
                <p id="userEmail" class="text-xs text-gray-500 mb-2 truncate" title="Usu√°rio logado"></p>
                <button id="logoutBtn" class="w-full text-left flex items-center gap-3 px-4 py-3 rounded-lg font-medium text-red-600 hover:bg-red-100 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9" /></svg>
                    Sair
                </button>
            </div>
        </nav>

        <!-- Conte√∫do Principal -->
        <main class="flex-1 p-8 overflow-auto">
            
            <!-- #1: Painel (Boas-vindas) -->
            <div id="app-painel" class="app-view">
                <h2 class="text-4xl font-bold text-gray-800 mb-6">Bem-vindo(a) ao seu StudyHub!</h2>
                <p class="text-xl text-gray-600 mb-8">Esta √© a sua central de ferramentas para o HackPad 2025.</p>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-2xl font-semibold mb-4">Como usar:</h3>
                    <ul class="list-disc list-inside space-y-2 text-gray-700">
                        <li>Use o menu √† esquerda para navegar entre as ferramentas.</li>
                        <li><strong class="text-indigo-600">Tarefas:</strong> Adicione, remova e marque suas tarefas.</li>
                        <li><strong class="text-indigo-600">Flashcards (IA) ‚ú®:</strong> Crie seus cards ou gere-os automaticamente com IA!</li>
                        <li><strong class="text-indigo-600">Timer Pomodoro:</strong> Inicie um timer de 25 minutos para focar.</li>
                        <li><strong class="text-indigo-600">Bloco de Notas:</strong> Anote rapidamente qualquer coisa.</li>
                    </ul>
                    <p class="mt-6 text-sm text-gray-500 font-medium">
                        Seus dados s√£o salvos na nuvem, em tempo real.
                    </p>
                </div>
            </div>

            <!-- #2: Lista de Tarefas -->
            <div id="app-tarefas" class="app-view hidden max-w-2xl mx-auto">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Lista de Tarefas</h2>
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <div class="flex gap-4 mb-4">
                        <input type="text" id="todoInput" class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="Ex: Entregar projeto de..." />
                        <button id="addTodoBtn" class="bg-indigo-600 text-white py-3 px-5 rounded-lg font-semibold hover:bg-indigo-700 transition shadow-md">Adicionar</button>
                    </div>
                    <ul id="todoList" class="space-y-3"></ul>
                </div>
            </div>

            <!-- #3: Metas Di√°rias -->
            <div id="app-metas" class="app-view hidden max-w-2xl mx-auto">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Metas Di√°rias</h2>
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <p class="text-gray-600 mb-4">Quais s√£o suas 3 prioridades para hoje?</p>
                    <textarea id="metasText" class="w-full h-48 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="1. ...&#10;2. ...&#10;3. ..."></textarea>
                    <button id="saveMetasBtn" class="mt-4 w-full bg-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-indigo-700 transition shadow-md">
                        Salvar Metas
                    </button>
                </div>
            </div>

            <!-- #4: Rastreador de H√°bitos (NOVO) -->
            <div id="app-habitos" class="app-view hidden max-w-2xl mx-auto">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Rastreador de H√°bitos</h2>
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <div class="flex gap-4 mb-4">
                        <input type="text" id="habitInput" class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="Ex: Estudar 1h de JS" />
                        <button id="addHabitBtn" class="bg-indigo-600 text-white py-3 px-5 rounded-lg font-semibold hover:bg-indigo-700 transition shadow-md">Adicionar H√°bito</button>
                    </div>
                    <ul id="habitosList" class="space-y-3"></ul>
                     <p class="text-xs text-gray-500 mt-4 text-center">Clique no h√°bito para marcar/desmarcar. Os h√°bitos s√£o resetados manualmente.</p>
                </div>
            </div>
            
            <!-- #5: Flashcards (COM IA) -->
            <div id="app-flashcards" class="app-view hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">M√≥dulo de Flashcards (IA) ‚ú®</h2>
                <main class="w-full max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Se√ß√£o da Esquerda: Criar Manual + Gerar com IA -->
                    <section class="bg-white p-6 rounded-xl shadow-lg space-y-6">
                        <!-- Gerador de IA -->
                        <div>
                            <h2 class="text-2xl font-semibold text-gray-900 mb-4">Gerar Cards com IA</h2>
                            <div class="space-y-4">
                                <div>
                                    <label for="aiThemeInput" class="block text-sm font-medium text-gray-700 mb-1">Tema:</label>
                                    <input type="text" id="aiThemeInput" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="Ex: Revolu√ß√£o Francesa">
                                </div>
                                <button id="aiGenerateBtn" class="w-full bg-green-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-700 transition shadow-md flex items-center justify-center gap-2 disabled:opacity-75">
                                    <span id="aiLoading" class="hidden"></span>
                                    Gerar 5 Cards
                                </button>
                            </div>
                        </div>
                        
                        <hr class="my-6 border-t border-gray-200">

                        <!-- Criar Manual -->
                        <div>
                            <h2 class="text-2xl font-semibold text-gray-900 mb-4">Criar Novo Card (Manual)</h2>
                            <div class="space-y-4">
                                <div>
                                    <label for="frente" class="block text-sm font-medium text-gray-700 mb-1">Frente (Pergunta):</label>
                                    <textarea id="frente" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="Ex: Qual a capital do Brasil?"></textarea>
                                </div>
                                <div>
                                    <label for="verso" class="block text-sm font-medium text-gray-700 mb-1">Verso (Resposta):</label>
                                    <textarea id="verso" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="Ex: Bras√≠lia"></textarea>
                                </div>
                                <button id="addCardBtn" class="w-full bg-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-indigo-700 transition shadow-md">Adicionar Card</button>
                                <button id="clearCardsBtn" class="w-full bg-red-500 text-white py-2 px-4 rounded-lg font-medium hover:bg-red-600 transition shadow-sm">Limpar Todos os Cards</button>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Se√ß√£o da Direita: Estudar Cards -->
                    <section class="flex flex-col">
                        <h2 class="text-2xl font-semibold text-gray-900 mb-4 text-center md:text-left">Estudar Cards</h2>
                        <div class="card-scene w-full h-64 md:h-80 mb-4">
                            <div id="cardContainer" class="card-container">
                                <div id="cardFrente" class="card-face card-face-front text-2xl font-semibold text-center">Crie um card para come√ßar!</div>
                                <div id="cardVerso" class="card-face card-face-back text-xl font-medium text-center"></div>
                            </div>
                        </div>
                        <p id="cardCounter" class="text-center text-gray-600 font-medium mb-4">Card 0 / 0</p>
                        <div class="flex justify-center gap-3 mb-3">
                            <button id="prevBtn" title="Anterior" class="bg-white p-3 rounded-full shadow-md hover:bg-gray-100 transition disabled:opacity-50 disabled:cursor-not-allowed"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 text-gray-700"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" /></svg></button>
                            <button id="flipBtn" class="bg-indigo-600 text-white py-3 px-8 rounded-lg font-semibold hover:bg-indigo-700 transition shadow-md flex-grow disabled:opacity-50 disabled:cursor-not-allowed">Virar Card</button>
                            <button id="nextBtn" title="Pr√≥ximo" class="bg-white p-3 rounded-full shadow-md hover:bg-gray-100 transition disabled:opacity-50 disabled:cursor-not-allowed"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 text-gray-700"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" /></svg></button>
                        </div>
                        <button id="shuffleBtn" class="w-full bg-gray-700 text-white py-2 px-4 rounded-lg font-medium hover:bg-gray-800 transition shadow-sm disabled:opacity-50 disabled:cursor-not-allowed">Embaralhar Cards</button>
                    </section>
                </main>
            </div>

            <!-- #6: Timer Pomodoro -->
            <div id="app-pomodoro" class="app-view hidden text-center max-w-md mx-auto">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Timer Pomodoro</h2>
                <div class="bg-white p-8 rounded-full shadow-2xl w-80 h-80 flex flex-col items-center justify-center mx-auto">
                    <h3 class="text-gray-500 text-lg font-medium">Tempo de Foco</h3>
                    <h1 id="timerDisplay" class="text-8xl font-extrabold text-gray-900 my-4">25:00</h1>
                    <p id="pomodoroStatus" class="text-lg text-gray-600 font-semibold">&nbsp;</p>
                </div>
                <div class="mt-8 flex justify-center gap-4">
                    <button id="startPomodoroBtn" class="bg-indigo-600 text-white text-xl py-4 px-10 rounded-lg font-bold hover:bg-indigo-700 transition shadow-lg">Iniciar</button>
                    <button id="resetPomodoroBtn" class="bg-gray-200 text-gray-800 text-xl py-4 px-10 rounded-lg font-bold hover:bg-gray-300 transition shadow-lg">Resetar</button>
                </div>
            </div>

            <!-- #7: Bloco de Notas -->
            <div id="app-notas" class="app-view hidden max-w-3xl mx-auto">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Bloco de Notas R√°pido</h2>
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <textarea id="notepadText" class="w-full h-96 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="Suas anota√ß√µes..."></textarea>
                    <button id="saveNoteBtn" class="mt-4 w-full bg-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-indigo-700 transition shadow-md">Salvar Anota√ß√£o</button>
                </div>
            </div>

            <!-- #8: Links R√°pidos -->
            <div id="app-links" class="app-view hidden max-w-2xl mx-auto">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Links R√°pidos</h2>
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                        <input type="text" id="linkNameInput" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="Nome do site (ex: Google)" />
                        <input type="text" id="linkUrlInput" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="URL (https://...)" />
                    </div>
                    <button id="addLinkBtn" class="w-full bg-indigo-600 text-white py-3 px-5 rounded-lg font-semibold hover:bg-indigo-700 transition shadow-md">Adicionar Link</button>
                    <ul id="linksList" class="space-y-3 mt-6"></ul>
                </div>
            </div>

            <!-- #9: Calculadora de M√©dia -->
            <div id="app-calculadora" class="app-view hidden max-w-md mx-auto">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Calculadora de M√©dia</h2>
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <div id="notasContainer" class="space-y-3 mb-4">
                        <div class="flex items-center gap-2">
                            <label for="nota-1" class="text-sm font-medium text-gray-700 w-12">Nota 1:</label>
                            <input type="number" id="nota-1" class="nota-input w-full p-2 border border-gray-300 rounded-lg" placeholder="0.0">
                        </div>
                        <div class="flex items-center gap-2">
                            <label for="nota-2" class="text-sm font-medium text-gray-700 w-12">Nota 2:</label>
                            <input type="number" id="nota-2" class="nota-input w-full p-2 border border-gray-300 rounded-lg" placeholder="0.0">
                        </div>
                    </div>
                    <button id="addNotaBtn" class="w-full bg-gray-200 text-gray-800 py-2 px-4 rounded-lg font-semibold hover:bg-gray-300 transition mb-4">
                        Adicionar outra nota
                    </button>
                    <button id="calcularMediaBtn" class="w-full bg-indigo-600 text-white py-3 px-5 rounded-lg font-semibold hover:bg-indigo-700 transition shadow-md">
                        Calcular M√©dia
                    </button>
                    <p id="mediaResultado" class="text-center text-2xl font-bold mt-6 text-gray-800"></p>
                </div>
            </div>

            <!-- #10: M√∫sica Foco (NOVO) -->
            <div id="app-musica" class="app-view hidden max-w-2xl mx-auto">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">M√∫sica para Foco</h2>
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <p class="text-gray-600 mb-6 text-center">Clique em um estilo para abrir uma playlist no YouTube e come√ßar a focar.</p>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <a href="https://www.youtube.com/results?search_query=lo-fi+hip+hop+radio" target="_blank" rel="noopener noreferrer" class="block bg-indigo-500 text-white text-center font-semibold p-6 rounded-lg shadow-md hover:bg-indigo-600 transition">
                            üéµ Lo-Fi Beats
                        </a>
                        <a href="https://www.youtube.com/results?search_query=classical+music+for+studying" target="_blank" rel="noopener noreferrer" class="block bg-green-500 text-white text-center font-semibold p-6 rounded-lg shadow-md hover:bg-green-600 transition">
                            üéª M√∫sica Cl√°ssica
                        </a>
                        <a href="https://www.youtube.com/results?search_query=rain+sounds+for+sleeping" target="_blank" rel="noopener noreferrer" class="block bg-blue-500 text-white text-center font-semibold p-6 rounded-lg shadow-md hover:bg-blue-600 transition">
                            üåßÔ∏è Som de Chuva
                        </a>
                        <a href="https://www.youtube.com/results?search_query=ocean+waves+sounds" target="_blank" rel="noopener noreferrer" class="block bg-cyan-500 text-white text-center font-semibold p-6 rounded-lg shadow-md hover:bg-cyan-600 transition">
                            üåä Ondas do Mar
                        </a>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Modal de Feedback (Oculto por padr√£o) -->
    <div id="feedbackModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl text-center">
            <p id="feedbackMessage" class="text-xl font-medium text-gray-800"></p>
        </div>
    </div>

    <!-- Modal de Confirma√ß√£o -->
    <div id="confirmModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl text-center max-w-sm">
            <p id="confirmMessage" class="text-lg font-medium text-gray-900 mb-6">Tem certeza?</p>
            <div class="flex justify-center gap-4">
                <button id="confirmBtnYes" class="bg-red-600 text-white py-2 px-8 rounded-lg font-semibold hover:bg-red-700 transition">Sim</button>
                <button id="confirmBtnNo" class="bg-gray-200 text-gray-800 py-2 px-8 rounded-lg font-semibold hover:bg-gray-300 transition">N√£o</button>
            </div>
        </div>
    </div>
</body>
</html>
